# 数独乐乐系统建模报告

## 引言

本报告将基于“数独乐乐”项目的功能需求和架构设计，提供一系列UML图来描述系统的行为和结构。

## 用例图

[用例图](用例图.uxf "打开用例图")描述了系统外部用户（参与者）与系统之间交互的功能：
![1751637489708](image/系统建模报告/1751637489708.png)

---

**用例描述**：

* **Actor**：
  * 玩家：与数独乐乐系统进行交互，能够实现输入数字、撤销、重做等操作，是该软件的行为的主要承担者；
  * 开发者：为数独乐乐软件集成新的算法策略并验证其正确性，维护软件的开发与维护，保障玩家用户的体验。
* **UseCase**：
  * **开始新游戏(startGame)**：玩家选择开始一个新的数独游戏；
  * **输入数字(enterNumber)**：玩家在数独棋盘的单元格中输入数字；
  * **撤销操作(undo)**：玩家撤销上一步操作；
  * **重做操作(redo)**：玩家重做之前撤销的操作；
  * **获得下一步提示(getHint)**：玩家请求系统给出下一步提示；
  * **导入SudokuWiKi题目(importPuzzles)**：玩家通过输入SudokuWiKi题目的URL来向软件导入题目；
  * **探索多种可能(exploreModeOn)**：玩家在面临多个可能答案时，可以进入探索模式，尝试不同的路径：
    * 包含**回溯到分支点(backtrackToBranch)**：在探索模式中，玩家可以回溯到之前做出选择的分支点 ；
    * 包含**采用策略(useStrategy)**：
      * 包含**显示采用策略**：在给出下一步策略的同时，系统会显示推理该答案所用的方法（策略）
      * 扩展策略：
        * **possibleNumber**：
          * 函数 `getPossibleNumber` 针对棋盘上每个空格，通过检查同行、同列和所属 3×3 宫内已经出现的数字，生成一个候选数字数组；
          * 对于已经填入数字的格子，其候选集合为空。
        * **nakedSingle**：
          * **原理**：如果某个格子的候选集合只有一个数字，则该数字就是必须填入的数；
          * **实现方式**：遍历所有候选数组，若某个候选数组长度为 1，则记录此格子和对应的唯一候选数字。
        * **hiddenSingle**:
          * **原理**：在某行、某列或某个 3×3 宫中，尽管某个格子的候选集合中可能有多个数字，但如果某个数字仅在整个单元内的某一个格子的候选集合中出现，则该格子必须填入这个数字。
          * **实现方式**：
            * 针对每个单元（行、列和盒子），枚举 1 到 9 的每个数字。
            * 对于当前数字，检查单元里每个格子的候选集合，记录该数字出现的格子索引。
            * 如果出现次数恰好为 1，并且该格子的候选集合长度大于 1（避免重复裸单情况），则记录为一个隐藏单元（`Hidden Single`）。
  * **集成新算法策略(addStrategy)**：开发者通过从SudokuWiKi等途径获取新的策略后导入集成到软件中。
  * **验证算法策略(validateStrategy)**：开发者需要检验将集成到软件中的算法的中却行，同时需要保障新旧算法之间的兼容性。

## 类图

用[类图](类图.uxf)描述数独乐乐系统的类功能，刻画其静态组成结构（图片过大，详见[类图](类图.uxf)）

---

**类描述：**

> 仅对关键组件类进行描述

1. **app**
   * **描述**：数独乐乐应用程序的主进入口和核心控制器。它协调各个组件，处理用户请求，管理游戏流程，并与用户界面、领域模型和外部服务进行交互。
   * **属性**：主要有以下四个抽象属性
     * **Board**：数独棋盘相关的组件，如数字键盘、操作栏等；
     * **Controls**：底部操作区有关的组件，如菜单、按钮等；
     * **Header**：顶部导航栏有关的组件，如不同类型的弹窗；
     * **Modal**：弹窗相关类型的组件。
   * **方法**：
     * 订阅gameWon变量，当游戏胜利时执行相应操作；
     * **onMount**：onMount钩子在组件首次挂载后执行，用于处理URL hash中的编码并弹出欢迎内容。
2. **Board**
   * **描述**：是对于app中Board抽象属性的功能展开。
   * **属性**：
     * **Candidates**：构建候选数字网络；
     * **Cell**：表示数独棋盘上的一个最小单元格。每个单元格有其行、列坐标、当前值、是否为初始固定数字以及可能的候选数字集合。
   * **方法**：这仍是一个抽象概念所以没有具体方法。
3. **Controls**
   * **描述**：是对app中Controls抽象属性的功能展开。
   * **属性**：
     * **ActionBar**：底层操作栏的容器组件
       * **Actions**：底层各项功能按钮逻辑，包括回溯、撤销、提示等操作；
       * **Timer**：计时功能，用于记录并展示游戏时长；
       * **Message**：消息展示区，用于在界面上提示或反馈操作信息。
     * **Keyboard**：提供屏幕数字键盘功能，让玩家直接点选输入数字。
   * **方法**：这仍是一个抽象概念所以没有具体方法。
4. **Header**
   * **描述**：是对app中Header抽象属性的功能展开。
   * **属性**：
     * **Button**：负责实现顶部的按钮功能，如分享、设置等；
     * **Dropdown**：用于实现游戏中的下拉菜单。
   * **方法**：这仍是一个抽象概念所以没有具体方法。
5. **Modal**
   * **描述**：是对app中Modal抽象属性的功能展开。
   * **属性**：share、QRcode、Settings、Confirm、Prompt、Welcome、GameOver等不同类型的弹窗组件。
   * **方法**：这仍是一个抽象概念所以没有具体方法。
6. **Candidates**
   * **描述**：对于Board中Candidates抽象属性的具体展开。
   * **属性**：
     * **candidates**：外部传来的候选数字集合；
     * **selected**：标识当前单元格是否被选中，用于回溯高亮显示。
   * **方法**：
     * **judgeRight**：判断当前候选号码是否为回溯中标记为正确的数字；
     * **judgeWrong**：判断当前候选号码是否为回溯中标记为错误的数字。
7. **Cell**
   * **描述**：对于Board中Cell抽象属性的具体展开。
   * **属性**：
     * **value**：当前单元格的值，若为空则为 undefined 或 0;
     * **cellX**：当前单元格在棋盘中的列坐标；
     * **cellY**：当前单元格在棋盘中的行坐标；
     * **candidates**：当前单元格的候选数字集；
     * **disable**：是否不可点击或被禁用；
     * **conflictingNumber**：当前单元格的数字是否与其他单元格冲突；
     * **userNumber**：标记该数字是否是用户填写的数字；
     * **selected**：当前单元格是否被选中（用于样式高亮；
     * **sameArea**：与选中单元格在同一区域（行/列/宫）中，用于辅助提示；
     * **sameNumber**：与选中数字相同，用于辅助提示。
   * **方法**：这是一个表示单元格状态的类，没有具体方法。
8. **Action**
   * **描述**：是对Controls\ActionBar中的Action抽象属性的具体实现。
   * **属性**：
     * **hintsAvailable**：计算剩余可用提示次数。
   * **方法**：
     * **handleHint**：使用提示--如果当前光标下有候选数字，则先清空，再应用系统自动填入的数字；
     * **handleLearn**：学习模式--通过 possibleNumberSolver 来获取一个可以确定的数字，并自动填入；
     * **handleBackTracking**：回溯功能--在检测到错误分支时，从存储的分支点处恢复并记录错误数字；
     * **handleUndo**：撤销操作--从 record 中拿到上一次的操作序列，逐一恢复；
     * **handleRedo**：重做操作--从 record 中读出当前可重做的操作序列，逐一应用。
9. **Keyboard**
   * **描述**：是对Controls中的Keyboard抽象属性的具体实现。
   * **属性**：
     * **keyboardDisabled**：决定是否禁用键盘。
   * **方法**：
     * **handleKeyButton**：处理按键按钮点击事件，根据传入的数字以及所处的状态执行相应的操作；
     * **handleKey**：处理全局键盘事件，根据按键值执行不同的操作。
10. **Buttons**
    * **描述**：是对Header中的Buttons抽象属性的具体实现。
    * **属性**：纯粹的方法类，没有明显属性。
    * **方法**：
      * **handleShareButton**：点击分享按钮时的处理函数；
      * **handleSettingsButton**：点击设置按钮时的处理函数。
11. **Dropdown**
    * **描述**：是对Header中的Dropdown抽象属性的具体实现。
    * **属性**：
      * **dropdownVisible**：标记下拉菜单是否处于显示状态。
    * **方法**：
      * **handleDifficulty**：处理点击某个难度选项的事件；
      * **handleCreateOwn**：处理“Create Own（自定义创建）”选项的点击事件。
12. **solver**
    * **描述**：定义了所有数独求解策略的公共接口。每个具体的策略类都需要实现这个接口，以提供获取提示或解决数独的方法。
    * **属性**：这是一个纯粹的方法类，没有具体的属性。
    * **方法**：

      * **nakedSingle**：利用裸单元法（naked single）找出每个候选数组中只有唯一候选数字的情况，将这些情况收集为一个 move 列表；
      * **hiddenSingle**：利用隐单法（hidden single）找出某一单位（行、列或盒）中唯一可填的数字，将这些情况加入到 move 列表中；
      * **getOnePossibleNumber**：根据给定的棋盘状态（二维数组），获取指定单元格（由 cellIndex 指定）的可能填入数字；
      * **getPossibleNumber**：计算整个数独棋盘中每个空白单元格的可能填入数字集合。
